<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.stylefeng.guns.modular.system.dao.UserMapper">

    <resultMap id="BaseResultMap" type="cn.stylefeng.guns.modular.system.model.User">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Dec 01 17:27:05 CST 2018.
        -->
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result column="avatar" property="avatar" jdbcType="VARCHAR"/>
        <result column="account" property="account" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="salt" property="salt" jdbcType="VARCHAR"/>
        <result column="nick_name" property="nickName" jdbcType="VARCHAR"/>
        <result column="user_signature" property="userSignature" jdbcType="VARCHAR"/>
        <result column="card_no" property="cardNo" jdbcType="VARCHAR"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="birthday" property="birthday" jdbcType="TIMESTAMP"/>
        <result column="sex" property="sex" jdbcType="INTEGER"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="roleid" property="roleid" jdbcType="VARCHAR"/>
        <result column="deptid" property="deptid" jdbcType="VARCHAR"/>
        <result column="reg_code" property="regCode" jdbcType="VARCHAR"/>
        <result column="balance" property="balance" jdbcType="DECIMAL"/>
        <result column="pay_sum" property="paySum" jdbcType="DECIMAL"/>
        <result column="withdraw_sum" property="withdrawSum" jdbcType="DECIMAL"/>
        <result column="wechat_num" property="wechatNum" jdbcType="VARCHAR"/>
        <result column="alipay_num" property="alipayNum" jdbcType="VARCHAR"/>
        <result column="qq_num" property="qqNum" jdbcType="VARCHAR"/>
        <result column="login_error_num" property="loginErrorNum" jdbcType="INTEGER"/>
        <result column="register_ip" property="registerIp" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="is_login" property="isLogin" jdbcType="INTEGER"/>
        <result column="login_time" property="loginTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Dec 01 17:27:05 CST 2018.
        -->
        id, avatar, account, password, salt, nick_name, user_signature, card_no, name, birthday,
        sex, email, phone, roleid, deptid, reg_code, balance, pay_sum, withdraw_sum, wechat_num,
        alipay_num, qq_num, login_error_num, register_ip, status, createtime, is_login, login_time
    </sql>

    <select id="selectUsers" resultType="map">
        select
        <include refid="Base_Column_List" />
        from sys_user
        <where>
            <if test="dto.name != null and dto.name != ''">
                (phone like CONCAT('%',#{dto.name},'%')
                or account like CONCAT('%',#{dto.name},'%')
                or name like CONCAT('%',#{dto.name},'%'))
            </if>
            <if test="dto.beginTime != null and dto.beginTime != '' and dto.endTime != null and dto.endTime != ''">
                and (createTime between CONCAT(#{dto.beginTime},' 00:00:00') and CONCAT(#{dto.endTime},' 23:59:59'))
            </if>
            <if test="dto.roleid != null and dto.roleid != ''">
                and roleid = #{dto.roleid}
            </if>
        </where>
    </select>

    <update id="setStatus">
        update sys_user set status = #{status} where id = #{userId}
    </update>

    <update id="changePwd">
        update sys_user set password = #{pwd} where id =
        #{userId}
    </update>

    <update id="setRoles">
        update sys_user set roleid = #{roleIds} where id =
        #{userId}
    </update>

    <select id="getByAccount" resultType="user">
        select
        <include refid="Base_Column_List" />
        from sys_user where account = #{account} and status != 3
    </select>

    <update id="updateUser" parameterType="cn.stylefeng.guns.modular.system.model.User">
        update sys_user
        <set>
            <if test="password != null and password != ''">password = #{password}, </if>
            <if test="salt != null and salt != ''">salt = #{salt}, </if>
            <if test="name != null and name != ''">name = #{name}, </if>
            <if test="nickName != null and nickName != ''">nick_name = #{nickName}, </if>
            <if test="roleid != null and roleid != ''">roleid = #{roleid}, </if>
            <if test="phone != null and phone != ''">phone = #{phone}, </if>
            <if test="email != null and email != ''">email = #{email}, </if>
            <if test="cardNo != null and cardNo != ''">card_no = #{cardNo}, </if>
            <if test="isLogin != null and isLogin != ''">is_login = #{isLogin}, </if>
            <if test="loginTime != null">login_time = #{loginTime}, </if>
        </set>
        where id = #{id}
    </update>
    
</mapper>